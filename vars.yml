# =============================================================================
# LINUX HARDENED REPOSITORY - VARIABLES
# =============================================================================



#========================WARNING WARNING WARNING WARNING=======================
# This file will be deleted as the final part of the lockdown script.
# This is to prevent passwords accidentally being left in plain text.
#========================WARNING WARNING WARNING WARNING=======================





# --- EXECUTION SWITCHES (yes/no or true/false) --------------------------------
# This will create a logical volume, format it as XFS and mount it.
# Set to "yes" or "true" to run storage configuration (LVM + XFS + mount).
# Set to "no" or "false" if storage has already been configured.
# Setting to yes will require configuration of the STORAGE: DISKS section below.
configure_storage: yes

# This will create a local admin user with sudo permissions.
# If you choose to disable root, this script will lock down the root account. Without creating an admin user, the only way to administer
# the system afterwards will be to enter single user mode. Single user mode is a recovery mode 
# reached by configuring options in the boot menu(grub) via the console. This is arguably more secure
# but incredibly inconvnient for managing the system.
# Having an admin user simplifies system administration at the cost of additional minor security
# risks. Customers can therefore choose how they would prefer to manage the system.
# The most secure and recommended option is to set this value to no.
# Configuring to yes will require setting the admin's username and password in the SECURITY / ACCOUNTS section.
# This uses the serveradmin_name and serveradmin_password variables.
create_admin_user: yes

# Disable SSH? This will disble the SSH server and prevent it from starting again at boot.
# Disabling SSH makes a system more difficult to adminster as it will require console access
# However it reduces potential security exposure since there are fewer ways to access the system.
# The DISA_STIG security profile recommends that SSH is enabled. Veeam recommend SSH is disabled.
disable_ssh: yes

# Disable root account password?
# Disabling the root account password will mean that access to the root account is not possible
# (unless some other means has been configured) without using single user mode, which is a recovery
# mode accessed via the boot menu (grub). This is a highly inconvinient way to manage a system.
# Veeam recommend disabling the root account password.
disable_root: yes

# Create GRUB user and password. 
# GRUB is the linux boot loader. Without this set it is possible to gain access to
# root account of a system without any passwords via the console. Even if the root account
# has had the password disabled. 
# Setting yes will overwrite any existing settings that may have been configured.
# The script will try to detect existing settings and fail if they are detected. But it cannot be relied on.
# Configuring to yes will require setting the username and password in the SECURITY / ACCOUNTS section.
# This uses the grub_superuser_name and grub_superuser_password variables. 
# This is recommended to be set to yes.
create_grub: yes

# Enable FIPS mode? FIPS mode ensures that system cryptography only uses approved algorithms e.g AES, SHA-2, RSA, ECDSA are used.
# Non compliant algoriths (e.g MD5, RC4 etc) will be disabled or rejected. This may cause incompatibilities if applications use non-compliant algorithms.
# Once enabled, FIPS cannot be disabled without leaving the system in an inconsistent configuration.
# If it needs to be disabled it is easier to reinstall and reconfigure the OS.
# FIPS mode is only supported on RHEL. It may work on Linux distributions
# in the Red Hat family, but isnt "technically" compliant since they dont inherit RHEL's certifications
# Enabling FIPS mode is recommended.
enable_FIPS: yes

# Set max usernamespaces to 0? This will prohibit a machine from running containers
# If a machine needs to run containers this should be set to no.
# It is recommended to set this to yes.
user_namespaces: yes

# Configure NTP to use only the server directive not pools?
# DISA STIG requires that NTP is configured using only specific servers. Not pools of servers.
# Setting this to yes will overwrite any existing configurations. 
# If set to yes then hostnames must be provided in the NTP CONFIGURATION section below. Multiple servers can be provided
# and they will be configured explicitly with the server directive. 
setup_ntp: yes

# Set up SSSD?
# SSSD validates user certificates from AD/LDAP.
# If not configured this will show as a fail in the DISA STIG report regardless of AD/LDAP integration. 
# It is recommended that customers do not integrate AD/LDAP with this server.
# Customers should therefore be given the option to configure this and understand that a fail is expected
# if not integrating with AD/LDAP. 
# Setting to yes will require completion of the SSSD Configuration section below.
setup_SSSD: yes

# --- STORAGE: DISKS ----------------------------------------------------------
# List block devices to use for the volume group (uncomment as needed, just delete the # as spacing is important in this file).
vol_disks:
#  - /dev/nvme0n1
#  - /dev/nvme1n1
#  - /dev/nvme2n1
#  - /dev/sda
  - /dev/sdb
#  - /dev/sdc
#  - /dev/vda
#  - /dev/vdb
#  - /dev/vdc
#  - /dev/mapper/mpatha
#  - /dev/mapper/mpathb
#  - /dev/mapper/mpathc

# Total LV size. Examples: "500g", "100%FREE".
# Can be larger than a single disk if given multiple disks (LVM spans PVs).
lvm_size: 25g
# Logical volume name.
vol_name: veeamvol
# Mount point for the filesystem.
vol_mount_point: /mnt/backupdata
# Volume group (LVM) name.
lvm_name: veeamlvm




# --- SECURITY / ACCOUNTS -----------------------------------------------------
# Service account name to be used.
veeam_user: vadmin
# Default Veeam user password.
veeam_user_password: 1234!
# Username for the local server admin account - with sudo.
serveradmin_name: serveradmin
# Password for the admin account.
serveradmin_password: 1234!
# Create a user for the bootloader - cannot be common names like root, admin, administrator
grub_superuser_name: grubuser
# Create a password for the bootloader user
grub_superuser_password: 1234!




# --- NTP CONFIGURATION -------------------------------------------------------
# DISA STIG requires specifying NTP servers specifically rather than pools
# list server names below
ntp_hostnames:
  - time.nist.gov
#  - time.google.com
#  - foo.example.com



# --- SSSD Configuration ----------------------------------------------------
# ---------------------------------------------------------------------------

# --- What SSSD is ---
# SSSD = System Security Services Daemon. Linux uses it to talk to AD/LDAP for
# identity, authentication, and access.
# To be DISA STIG compliant SSSD needs a certmap to validate a presented user certificate.
# A certmap tells SSSD:
#   (1) which directory "domain" to search,
#   (2) which certificates to accept,
#   (3) how to find the ONE user that owns the presented certificate.

# (1) DIRECTORY DOMAIN(S) TO SEARCH
certmap_domain_id: "testing.test"
# WHAT: Exact SSSD domain ID (the name inside [domain/<ID>] in /etc/sssd/sssd.conf).
# WHERE TO GET: From the AD/LDAP team.

certmap_search_domains: ["testing.test"]
# WHAT: Additional search domains names SSSD will search for the user.
# WHERE TO GET: From the AD/LDAP team; include trusted domains only if you must search them.

# (2) WHICH CERTIFICATES TO ACCEPT
certmap_matchrule: "<SAN>.*EDIPI@mil"
# WHAT: Acceptance filter for certs (match on SAN/UPN/email, Issuer DN, EKU, etc.; you can combine with &&).
# WHERE TO GET: From the PKI/certificate team; verify by inspecting a sample user cert.
# ---------------------------------------------------------------------------
# Common, valid MATCHRULE examples (paste ONE into certmap_matchrule)
# - Issuer DN is exactly your corporate CA:
#   "<ISSUER>^CN=Corp-CA,DC=example,DC=com$"
# - Must have client authentication EKU:
#   "<EKU>clientAuth"
# - AD UPN in SAN ends with your realm:
#   "<SAN:ntPrincipalName>.*@EXAMPLE\.COM"
# - Email in SAN is your mail domain:
#   "<SAN:rfc822Name>.*@example\.com"
# - Stricter combo (Issuer + EKU + UPN SAN):
#   "<ISSUER>^CN=Corp-CA,DC=example,DC=com$&&<EKU>clientAuth&&<SAN:ntPrincipalName>.*@EXAMPLE\.COM"

# (3) HOW TO MAP CERT → USER ACCOUNT
certmap_maprule: "(userCertificate;binary={cert!bin})"
# WHAT: LDAP filter rule that turns an accepted cert into a specific directory user.
# WHERE TO GET: From the AD/LDAP team (confirm which user attribute is populated and supported).
# WHY: If this doesn’t match how your directory stores/identifies users, logins will fail.
# Common, valid MAPRULE examples (paste ONE into certmap_maprule)
# - Exact certificate match (directory stores full cert on users):
#   "(userCertificate;binary={cert!bin})"
# - Derive identity from SAN UPN (works well with AD):
#   "(|(userPrincipalName={subject_nt_principal})(sAMAccountName={subject_nt_principal.short_name}))"
# - Derive identity from SAN email:
#   "(|(mail={subject_rfc822_name})(uid={subject_rfc822_name.short_name}))"
# - FreeIPA-style mapping using issuer/subject DNs:
#   "(ipaCertMapData=X509:<I>{issuer_dn!ad}<S>{subject_dn!ad})"

# label only
certmap_rule_name: "rule_4_DISA_STIG"
# WHAT: A short label for this mapping rule.


#
#
# ---------------------------------------------------------------------------
# This is what will be written into /etc/sssd/sssd.conf (certmap section):
#
# TEMPLATE (uses the variables denoted by {{ xyz }})
# [certmap/{{ certmap_domain_id }}/{{ certmap_rule_name }}]
# matchrule = {{ certmap_matchrule }}
# maprule  = {{ certmap_maprule }}
# domains  = {{ certmap_search_domains | join(',') }}
#
# EXAMPLE (with the sample values below)
# [certmap/testing.test/rule_edipi]
# matchrule = <SAN>.*EDIPI@mil
# maprule  = (userCertificate;binary={cert!bin})
# domains  = testing.test
# ---------------------------------------------------------------------------





# --- NAMING DEFAULTS ---------------------------------------------------------


# --- COMPLIANCE / SCAP REPORTING --------------------------------------------
# Path to SSG content (datastreams).
ssg_dir: /usr/share/xml/scap/ssg/content
# DISA STIG profile ID.
ssg_profile: xccdf_org.ssgproject.content_profile_stig
# Filenames for pre/post scan results and reports.
results_file: checkpoint_STIG_scan_results.xml
remediation_file: DISA_STIG_remediations.yml
report_file: checkpoint_STIG_compliance_report.html
post_fix_results_file: post_harden_STIG_scan_results.xml
post_fix_report_file: "{{ [playbook_dir, 'reports', 'post_hardening_STIG_compliance_report.html'] | path_join }}"
pre_fix_results_file: pre_harden_STIG_scan_results.xml
pre_fix_report_file: "{{ [playbook_dir, 'reports', 'pre_hardening_STIG_compliance_report.html'] | path_join }}"
